syntax = "proto3";
// buf:lint:ignore PACKAGE_DIRECTORY_MATCH
package appsets.api.v1;
option go_package = "github.com/appsets/protocol/go/api/v1;apipb";

import "google/api/annotations.proto";
import "google/protobuf/wrappers.proto";
import "google/rpc/status.proto";

message AccountEmail {
  string email = 1;
  string password = 2;
  map<string, string> vars = 3;
}

message AuthenticateEmailRequest {
  AccountEmail account = 1;
  google.protobuf.BoolValue create = 2;
  string username = 3;
}

message SessionResponse {
  google.rpc.Status error = 1;
  bool created = 2;
  string token = 3;
  string refresh_token = 4;
  UserInfo user_info = 5;
}

message UserInfo {
  int64 id = 1;
  string username = 2;
  string display_name = 3;
  string avatar_url = 4;
  string email = 5;
  string phone = 6;
}



message RefreshTokenRequest {
  string token = 1;
}

service AccountService {
  // buf:lint:ignore RPC_REQUEST_RESPONSE_UNIQUE
  // buf:lint:ignore RPC_RESPONSE_STANDARD_NAME
  rpc AuthenticateEmail(AuthenticateEmailRequest) returns (SessionResponse) {
    option (google.api.http) = {
      post: "/api/v1/authenticate/email"
      body: "*"
    };
  }
  // buf:lint:ignore RPC_REQUEST_RESPONSE_UNIQUE
  // buf:lint:ignore RPC_RESPONSE_STANDARD_NAME
  rpc RefreshToken(RefreshTokenRequest) returns (SessionResponse) {
    option (google.api.http) = {
      post: "/api/v1/authenticate/token/refresh"
      body: "*"
    };
  }
}

